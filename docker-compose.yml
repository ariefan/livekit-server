services:
  redis:
    image: redis:7-alpine
    container_name: livekit-redis
    restart: unless-stopped
    network_mode: host

  livekit:
    image: livekit/livekit-server:latest
    container_name: livekit-server
    restart: unless-stopped
    command: --config /etc/livekit.yaml --bind 0.0.0.0
    network_mode: host
    volumes:
      - /opt/livekit/livekit.yaml:/etc/livekit.yaml:ro
    depends_on:
      - redis

  egress:
    image: livekit/egress:latest
    container_name: livekit-egress
    restart: unless-stopped
    network_mode: host
    volumes:
      - /opt/livekit/egress.yaml:/etc/egress.yaml:ro
    environment:
      - EGRESS_CONFIG_FILE=/etc/egress.yaml
    depends_on:
      - livekit
